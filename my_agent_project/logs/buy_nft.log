

===== 新购买流程开始: 2025-04-30 09:29:30 =====
tokenId=1, buyerAddr=0x90f79bf6eb2c4f870365e785982e1f101e93b906
Check listing 输出:
ListingStatus=Listed, price=1
metadataURL=http://127.0.0.1:8080/ipfs/QmSFJ36fdoMZp8Kv9XsGWB6Jya3Hd1rkTzj8aUkwjtMvJQ
请求转账: 1.0 ETH 到 0x70997970C51812dc3A010C7d01b50e0d17dc79C8
在历史区块 18 找到匹配交易，hash=857301b4a3159421187c2fceaa928f451596e576d9900c6ddf5d753a059e449c
加密的 zip_cid=HIhJKD71Gj1U4ASFf5T0cQDTlu8nROghFK0kaoHy5G5BiIZUHVgxy1vKslobn2HDeJdp72hqfQPkhae2oy2xp1bGh/KBY4gdCRi6WaETF4qa1+e8CrgnxjfN+rNC+ZPf5Sr9XqDlEP/CWVQOe6vzLt72+8gkIJs4jEZ2hJqJoziZOIOv+7Bpn4Xkjt3sw8/fPp3hNMe/B5YXMUBaPnXIws6Tu30N1VUcRdVuuliXBqGm5xhdfGSxbcr7UJcC4FtYqI9gVak3/mX3AoJBYZf+qclanGv41byGUriVlWTHr9b02wNkHMw6DlXubSirRl2z1igqkedZH/jWWk6PQTxGSw==
解密脚本输出:
Decrypted CID: Qmdf1q4XorJmixhNAioH1EYVposcno5XbUH53aed6nDNu1
已成功下载: CID=Qmdf1q4XorJmixhNAioH1EYVposcno5XbUH53aed6nDNu1 => /Users/dylan/Code_Projects/Python_Projects/image_similarity/my_agent_project/features/../data/dataset.zip
水印生成完毕，已生成 dataset_watermark.zip
[uploadForBuyer]输出:
开始执行 uploadForBuyer.js 脚本
使用公钥路径: /Users/dylan/Code_Projects/Python_Projects/image_similarity/my_agent_project/temp_public_key.pem
成功读取公钥，长度为 450 字符
尝试读取的数据集路径: /Users/dylan/Code_Projects/Python_Projects/image_similarity/my_agent_project/data/dataset_watermark.zip
找到水印数据集文件，大小为 1196686 字节
正在准备连接IPFS...
成功连接到IPFS API
正在读取水印数据集文件...
上传数据集到IPFS (大小: 1196686 字节)...
数据集上传成功，CID: Qmd4DX5xHEMfsAaEgHQmLRzFuC6z4LSsoanQmWqdqbJZGy
使用买家公钥加密CID...
准备加密数据: Qmd4DX5xHEMfsAaEgHQmLRzFuC6z4LSsoanQmWqdqbJZGy
加密成功，结果长度: 344 字符

===== Final Output =====
rawCid=Qmd4DX5xHEMfsAaEgHQmLRzFuC6z4LSsoanQmWqdqbJZGy
encryptedCid=Ax3ztXCZaNI0hnvn5XRiUufRxsJH4pBZsxqa79PM91lmdWeo7O2QT4gMQxytpdYPYAhEwWcHdCaeoPqao5RhV7KaM/6pc+yeQDHQ96lsVVws+TTEMXfKClWYpXL2jMalsaHm9hkzD2NKLbV4UHxHVeYiKLKfsGZLtfKOjTmzEO31VO0hjCFuvfp2aLlvsW11OlLsfrev7FVhEntvyS/ZFIDmhqzIUcGqhzI1EOl6mHU4zKBidVjzkPlOgOqT9bwzrLgRAcmPjTiz3t7857fKHgLVDldOeUb7PIguFtLKF6Z6YB1cndc2vhaOAGpGCr0XtbaOdSLvpKx/Kt2tvM0muw==
成功加密并上传, encryptedCid = Ax3ztXCZaNI0hnvn5XRiUufRxsJH4pBZsxqa79PM91lmdWeo7O2QT4gMQxytpdYPYAhEwWcHdCaeoPqao5RhV7KaM/6pc+yeQDHQ96lsVVws+TTEMXfKClWYpXL2jMalsaHm9hkzD2NKLbV4UHxHVeYiKLKfsGZLtfKOjTmzEO31VO0hjCFuvfp2aLlvsW11OlLsfrev7FVhEntvyS/ZFIDmhqzIUcGqhzI1EOl6mHU4zKBidVjzkPlOgOqT9bwzrLgRAcmPjTiz3t7857fKHgLVDldOeUb7PIguFtLKF6Z6YB1cndc2vhaOAGpGCr0XtbaOdSLvpKx/Kt2tvM0muw==
购买输出: 开始轮询区块，查找 bob->0x70997970C51812dc3A010C7d01b50e0d17dc79C8 转账金额=1000000000000000000 wei
在区块 18 找到匹配交易,hash=857301b4a3159421187c2fceaa928f451596e576d9900c6ddf5d753a059e449c
确认收到来自 0x90F79bf6EB2c4f870365E785982E1f101E93b906 的付款, 交易hash=857301b4a3159421187c2fceaa928f451596e576d9900c6ddf5d753a059e449c

=== 调用 purchaseNFT(tokenId=1, buyer=0x90F79bf6EB2c4f870365E785982E1f101E93b906, encCid=...) ===
purchaseNFT 交易哈希: 016c92c44c510a0e959a671881adee9b777f8a9854d23b77374311d577372611
NFTPurchased => operator=0x70997970C51812dc3A010C7d01b50e0d17dc79C8, tokenId=1, dataOwner=0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC, ethPaid=1 ETH, encCid=Ax3ztXCZaNI0hnvn5XRiUufRxsJH4pBZsxqa79PM91lmdWeo7O2QT4gMQxytpdYPYAhEwWcHdCaeoPqao5RhV7KaM/6pc+yeQDHQ96lsVVws+TTEMXfKClWYpXL2jMalsaHm9hkzD2NKLbV4UHxHVeYiKLKfsGZLtfKOjTmzEO31VO0hjCFuvfp2aLlvsW11OlLsfrev7FVhEntvyS/ZFIDmhqzIUcGqhzI1EOl6mHU4zKBidVjzkPlOgOqT9bwzrLgRAcmPjTiz3t7857fKHgLVDldOeUb7PIguFtLKF6Z6YB1cndc2vhaOAGpGCr0XtbaOdSLvpKx/Kt2tvM0muw==

 [92m=== purchaseNFT 成功, 您已获得访问权. ===[0m
===== 购买流程成功完成 =====
最终加密CID: Ax3ztXCZaNI0hnvn5XRiUufRxsJH4pBZsxqa79PM91lmdWeo7O2QT4gMQxytpdYPYAhEwWcHdCaeoPqao5RhV7KaM/6pc+yeQDHQ96lsVVws+TTEMXfKClWYpXL2jMalsaHm9hkzD2NKLbV4UHxHVeYiKLKfsGZLtfKOjTmzEO31VO0hjCFuvfp2aLlvsW11OlLsfrev7FVhEntvyS/ZFIDmhqzIUcGqhzI1EOl6mHU4zKBidVjzkPlOgOqT9bwzrLgRAcmPjTiz3t7857fKHgLVDldOeUb7PIguFtLKF6Z6YB1cndc2vhaOAGpGCr0XtbaOdSLvpKx/Kt2tvM0muw==
